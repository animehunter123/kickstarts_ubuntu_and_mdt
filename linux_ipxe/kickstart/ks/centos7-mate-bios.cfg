#platform=x86, AMD64, or Intel EM64T
#version=DEVEL
# Install OS instead of upgrade
install
# Keyboard layouts
keyboard 'us'
# Root password
rootpw --iscrypted $1$VzQErpFK$r6MVLh9oJAzWKoFKyuAol/
# System language
lang en_US
# System authorization information
auth  --useshadow  --passalgo=sha512
# Use text mode install
text
# Run the Setup Agent on first boot
firstboot --disable
# SELinux configuration
selinux --disabled

# Use NFS installation media
nfs --server=lm-nas.lm.local --dir=/volume1/INSERT_YOUR_NASNFSSHARE_HERE/repos/centos/7/os/x86_64/

# Firewall configuration
firewall --disabled
# Reboot after installation
reboot
# System timezone
timezone Asia/Tokyo
# System bootloader configuration
bootloader --location=mbr
# Clear the Master Boot Record
zerombr
# Partition clearing information
clearpart --all --initlabel

repo --name=centos7-os --baseurl=http://lm-nas.lm.local:8084/repos/centos/7/os/x86_64
repo --name=centos7-updates --baseurl=http://lm-nas.lm.local:8084/repos/centos/7/updates/x86_64
repo --name=centos7-extras --baseurl=http://lm-nas.lm.local:8084/repos/centos/7/extras/x86_64
repo --name=epel7 --baseurl=http://lm-nas.lm.local:8084/repos/epel/7/x86_64

# Disk partitioning information
part swap --fstype="swap" --recommended
part /boot --fstype="ext4" --size=500
part / --fstype="ext4" --grow --size=1

%post
# Pull the post scripts from gitlab:   http://lm-gitlab/lm/kickstart/-/tree/master/post-scripts
exec < /dev/tty4 > /dev/tty4
chvt 4
    #Repos must come first
    # Executing kickstart post script... set-centos7-repos.sh
    wget -c "http://lm-gitlab/lm/kickstart/-/raw/master/post-scripts/set-centos7-repos.sh";
    bash "./set-centos7-repos.sh";

    # Executing kickstart post script... install-mate-desktop.sh
    wget -c "http://lm-gitlab/lm/kickstart/-/raw/master/post-scripts/install-mate-desktop.sh";
    bash "./install-mate-desktop.sh";

    # Executing kickstart post script... set-centos7-history.sh
    wget -c "http://lm-gitlab/lm/kickstart/-/raw/master/post-scripts/set-centos7-history.sh";
    bash "./set-centos7-history.sh";

    # Executing kickstart post script... set-centos7-resolv.conf.sh
    wget -c "http://lm-gitlab/lm/kickstart/-/raw/master/post-scripts/set-centos7-resolv.conf.sh";
    bash "./set-centos7-resolv.conf.sh";

    # Install MATE Desktop
    yum clean all
    yum groupinstall -y "Server with GUI"
    yum group install -y "MATE Desktop"
    systemctl disable initial-setup
    systemctl disable initial-setup-text
    systemctl disable initial-setup-graphical
    systemctl disable initial-setup-reconfiguration
    cd /usr/share/xsessions
    mkdir OLD
    mv * OLD
    mv OLD/mate.desktop .
    systemctl set-default graphical.target

chvt 1
%end

%packages
@base
cifs-utils
nfs-utils
git-all
%end
